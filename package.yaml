name: matrix-sized
version: "0.1.2"
category: "Math"
synopsis:    "Haskell matrix library with interface to C++ linear algebra libraries."
description: "A Haskell implementation of matrices with statically known sizes.
                The library also comes with the bindings to high performance
                C++ linear algebra libraries such as Eigen and Spectra."
license: "BSD-3-Clause"
author: "Kai Zhang"
copyright: "(c) 2020-2021 Kai Zhang"
maintainer: "kai@kzhang.org"

ghc-options: -Wall

extra-source-files:
  - cbits/*.h

  - eigen3/Eigen/*
  - eigen3/Eigen/src/**/*.h
  - eigen3/Eigen/src/Core/**/*.h
  - eigen3/Eigen/src/Core/arch/**/*.h
  - eigen3/Eigen/src/Geometry/arch/*.h
  - eigen3/Eigen/src/LU/arch/*.h

  - spectra/Spectra/*.h
  - spectra/Spectra/**/*.h
  - spectra/Spectra/MatOp/**/*.h

  - README.md
  - ChangeLog.md

flags:
  parallel:
    description: Enable multithreading
    manual: true
    default: false

library:
  source-dirs:
    - src
  exposed-modules:
    - Data.Matrix.Static.Dense
    - Data.Matrix.Static.Dense.Mutable
    - Data.Matrix.Static.Sparse
    - Data.Matrix.Static.Sparse.Mutable
    - Data.Matrix.Static.LinearAlgebra
    - Data.Matrix.Static.LinearAlgebra.Types
    - Data.Matrix.Static.Generic
    - Data.Matrix.Static.Generic.Mutable
    - Data.Matrix.Static.IO
    - Data.Matrix.Dynamic

  other-modules: 
    - Data.Matrix.Static.Internal
    - Data.Matrix.Static.LinearAlgebra.Internal

  dependencies:
    - base >= 4.10 && < 5
    - bytestring
    - bytestring-lexing
    - double-conversion
    - conduit
    - primitive >= 0.6.4.0
    - singletons
    - vector >= 0.11
    - store

  include-dirs:
    - eigen3
    - spectra
    - cbits

  when:
  - condition: flag(parallel)
    ld-options:
    - -fopenmp
    cc-options:
    - -fopenmp
    cxx-options:
    - -fopenmp
    - -std=c++11

  cxx-sources:
    - cbits/*.cpp
  cxx-options:
    - -std=c++11

  extra-libraries: stdc++

tests:
  test:
    main: "Main.hs"
    ghc-options: "-threaded"

    source-dirs:
      - tests

    other-modules:
      - Test.Base
      - Test.LinearAlgebra
      - Test.Utils

    dependencies:
      - base
      - conduit
      - data-ordlist
      - store
      - matrix-sized
      - ieee754
      - singletons
      - tasty
      - tasty-quickcheck
      - vector

    #ld-options: "-fopenmp"

github: kaizhang/matrix-sized
